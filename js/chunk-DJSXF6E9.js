import{u as e,b as l,i as t,d as a}from"./chunk-TqyiIdB8.js";import{d as s,u as n,l as o,s as u,r as i,h as c,w as r,o as d,a as p,b,t as m,j as f,F as x,B as v,k as g,C as w,D as C,E as h,G as k,q as y,I as U}from"./chunk-D11PtkFx.js";const z={class:"flex w-full gap-3"},P={role:"alert",class:"w-full my-4 alert alert-info"},L={class:"p-0 m-0"},D={class:"max-w-xs mb-10 form-control"},V={class:"flex flex-col items-center gap-2 pt-5"},j={class:"w-1/2 max-w-xs mb-10 form-control"},A={class:"label"},$={class:"label-text"},S=["onUpdate:modelValue","placeholder"],I={class:"w-1/2 max-w-xs mb-10 form-control"},M={class:"label"},N={class:"label-text"},O=["onUpdate:modelValue"],T={class:"w-1/2 max-w-xs mb-10 form-control"},q={class:"label"},B={class:"label-text"},H=["checked","onChange"],_={class:"w-1/2 max-w-xs mb-10 form-control"},E={class:"label"},F={class:"label-text"},G=["onUpdate:modelValue","placeholder","onChange"],R=["data-tip"],J=["value","max"],K={class:"w-1/2 max-w-xs mb-10 form-control"},Q={class:"label"},W={class:"label-text"},X=["checked","onChange"],Y={class:"w-full max-w-xs mb-10 form-control"},Z={class:"label"},ee={class:"label-text"},le=["onUpdate:modelValue"],te={key:0,value:{id:"",name:"",url:""}},ae={disabled:"",selected:""},se=["value"],ne={key:0,class:"w-full max-w-xs mb-10 form-control"},oe={class:"label"},ue={class:"label-text"},ie=["onClick"],ce={key:0,class:"flex flex-wrap w-full h-full gap-1 p-0 pt-1 m-0 cursor-pointer"},re=["data-tip"],de={key:1,class:"btn btn-secondary btn-xs"},pe={class:"w-full max-w-xs mb-10 form-control"},be={class:"label"},me={class:"label-text"},fe={class:"flex gap-2"},xe=["onClick"],ve=s({__name:"PrizeConfig",setup(s){const{t:ve}=n(),ge=o.createInstance({name:"imgStore"}),we=e().prizeConfig,Ce=e().globalConfig,{getPrizeConfig:he,getCurrentPrize:ke}=u(we),{getImageList:ye}=u(Ce),Ue=i(he),ze=i([]),Pe=i();function Le(){const e={id:(new Date).getTime().toString(),name:t.global.t("data.prizeName"),sort:0,isAll:!1,count:1,isUsedCount:0,picture:{id:"",name:"",url:""},separateCount:{enable:!1,countList:[]},desc:"",isUsed:!1,isShow:!0,frequency:1,tag:""};we.addPrizeConfig(e)}function De(e){Pe.value.separateCount.countList=e,Pe.value=null}function Ve(){we.resetDefault()}function je(e,l){const t=Ue.value.indexOf(e);1===l?(Ue.value.splice(t,1),Ue.value.splice(t-1,0,e)):(Ue.value.splice(t,1),Ue.value.splice(t+1,0,e))}async function Ae(){await we.deleteAllPrizeConfig()}return c((()=>{!async function(){(await ge.keys()).length>0&&ge.iterate(((e,l)=>{ze.value.push({key:l,value:e})}))}()})),r((()=>Ue.value),(e=>{we.setPrizeConfig(e)}),{deep:!0}),(e,t)=>{var s,n;const o=a;return d(),p("div",null,[b("h2",null,m(f(ve)("viewTitle.prizeManagement")),1),b("div",z,[b("button",{class:"btn btn-info btn-sm",onClick:Le},m(f(ve)("button.add")),1),b("button",{class:"btn btn-info btn-sm",onClick:Ve},m(f(ve)("button.resetDefault")),1),b("button",{class:"btn btn-error btn-sm",onClick:Ae},m(f(ve)("button.allDelete")),1)]),b("div",P,[t[0]||(t[0]=b("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",class:"w-6 h-6 stroke-current shrink-0"},[b("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)),b("span",null,m(f(ve)("dialog.tipResetPrize")),1)]),b("ul",L,[(d(!0),p(x,null,v(Ue.value,(e=>(d(),p("li",{key:e.id,class:w(["flex gap-10",f(ke).id===e.id?"border-1 border-dotted rounded-xl":null])},[b("label",D,[b("div",V,[g(o,{class:w(["cursor-pointer hover:text-blue-400",0===Ue.value.indexOf(e)?"opacity-0 cursor-default":""]),name:"up",onClick:l=>je(e,1)},null,8,["class","onClick"]),g(o,{class:w(["cursor-pointer hover:text-blue-400",Ue.value.indexOf(e)===Ue.value.length-1?"opacity-0 cursor-default":""]),name:"down",onClick:l=>je(e,0)},null,8,["class","onClick"])])]),b("label",j,[b("div",A,[b("span",$,m(f(ve)("table.prizeName")),1)]),C(b("input",{"onUpdate:modelValue":l=>e.name=l,type:"text",placeholder:f(ve)("placeHolder.name"),class:"w-full max-w-xs input-sm input input-bordered"},null,8,S),[[h,e.name]])]),b("label",I,[b("div",M,[b("span",N,m(f(ve)("table.tag")),1)]),C(b("input",{"onUpdate:modelValue":l=>e.tag=l,type:"text",placeholder:"Tag",class:"w-full max-w-xs input-sm input input-bordered"},null,8,O),[[h,e.tag]])]),b("label",T,[b("div",q,[b("span",B,m(f(ve)("table.fullParticipation")),1)]),b("input",{type:"checkbox",checked:e.isAll,class:"mt-2 border-solid checkbox checkbox-secondary border-1",onChange:l=>e.isAll=!e.isAll},null,40,H)]),b("label",_,[b("div",E,[b("span",F,m(f(ve)("table.numberParticipants")),1)]),C(b("input",{"onUpdate:modelValue":l=>e.count=l,type:"number",placeholder:f(ve)("placeHolder.winnerCount"),class:"w-full max-w-xs p-0 m-0 input-sm input input-bordered",onChange:l=>function(e){let l=-1;for(let t=0;t<Ue.value.length;t++)if(Ue.value[t].id===e.id){l=t;break}l>-1&&(Ue.value[l].separateCount.countList=[],Ue.value[l].isUsed?Ue.value[l].isUsedCount=Ue.value[l].count:Ue.value[l].isUsedCount=0)}(e)},null,40,G),[[h,e.count]]),b("div",{class:"tooltip tooltip-bottom","data-tip":`${f(ve)("table.isDone")+e.isUsedCount}/${e.count}`},[b("progress",{class:"w-full progress",value:e.isUsedCount,max:e.count},null,8,J)],8,R)]),b("label",K,[b("div",Q,[b("span",W,m(f(ve)("table.isDone")),1)]),b("input",{type:"checkbox",checked:e.isUsed,class:"mt-2 border-solid checkbox checkbox-secondary border-1",onChange:l=>function(e){e.isUsed?e.isUsedCount=0:e.isUsedCount=e.count,e.separateCount.countList=[],e.isUsed=!e.isUsed}(e)},null,40,X)]),b("label",Y,[b("div",Z,[b("span",ee,m(f(ve)("table.image")),1)]),C(b("select",{"onUpdate:modelValue":l=>e.picture=l,class:"w-full max-w-xs select select-warning select-sm"},[e.picture.id?(d(),p("option",te,"âŒ")):y("",!0),b("option",ae,m(f(ve)("table.selectPicture")),1),(d(!0),p(x,null,v(f(ye),(e=>(d(),p("option",{key:e.id,value:e},m(e.name),9,se)))),128))],8,le),[[k,e.picture]])]),e.separateCount?(d(),p("label",ne,[b("div",oe,[b("span",ue,m(f(ve)("table.onceNumber")),1)]),b("div",{class:"flex justify-start w-full h-full",onClick:l=>function(e){Pe.value=e,Pe.value.isUsedCount=0,Pe.value.isUsed=!1,Pe.value.separateCount.countList.length>1||(Pe.value.separateCount={enable:!0,countList:[{id:"0",count:e.count,isUsedCount:0}]})}(e)},[e.separateCount.countList.length?(d(),p("ul",ce,[(d(!0),p(x,null,v(e.separateCount.countList,(e=>(d(),p("li",{key:e.id,class:"relative flex items-center justify-center w-8 h-8 bg-slate-600/60 separated"},[b("div",{class:"flex items-center justify-center w-full h-full tooltip","data-tip":`${f(ve)("tooltip.doneCount")+e.isUsedCount}/${e.count}`},[b("div",{class:"absolute left-0 z-50 h-full bg-blue-300/80",style:U(`width:${100*e.isUsedCount/e.count}%`)},null,4),b("span",null,m(e.count),1)],8,re)])))),128))])):(d(),p("button",de,m(f(ve)("button.setting")),1))],8,ie)])):y("",!0),b("label",pe,[b("div",be,[b("span",me,m(f(ve)("table.operation")),1)]),b("div",fe,[b("button",{class:"btn btn-error btn-sm",onClick:l=>function(e){we.deletePrizeConfig(e.id)}(e)},m(f(ve)("button.delete")),9,xe)])])],2)))),128))]),g(l,{"total-number":null==(s=Pe.value)?void 0:s.count,"separated-number":null==(n=Pe.value)?void 0:n.separateCount.countList,onSubmitData:De},null,8,["total-number","separated-number"])])}}});export{ve as default};
